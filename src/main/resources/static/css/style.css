:root {
  --header-height: 60px;
  --sidebar-width-expanded: 160px;
  /* 広げた時の幅 */
  --sidebar-width-collapsed: 120px;
  /* 畳んだ時の幅を少し広げる */
  /* JSが失敗した場合の予備として100vhを設定 */
  --app-height: 100vh;
}

/* デスクトップ表示をデフォルトのスタイルとする */
body {
  padding-top: var(--header-height);
  user-select: none;
  -webkit-user-select: none;
  /* Safari互換用 */
}

input,
textarea,
.selectable-content {
  user-select: text;
  -webkit-user-select: text;
}

.header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--header-height);
  background-color: #ffffff;
  z-index: 1050;
  /* ▼▼▼ 追加: PC表示でのヘッダー下線 ▼▼▼ */
  border-bottom: 1px solid #dee2e6;
}

.offcanvas-md {
  --bs-offcanvas-width: var(--sidebar-width-expanded);
}

/* サイドバー内リンクの基本スタイル（横並び） */
.offcanvas-body .nav-link {
  display: flex;
  align-items: center;
  /* アイコンとテキストを垂直方向に中央揃え */
  padding: 1rem 1.5rem;
  /* パディングを調整 */
}

.offcanvas-body .nav-link .bi {
  margin-right: 0.75rem;
  /* アイコンの右側に余白を設定 */
}

/* --- モーダルのカスタムスタイル (ダークテーマ) --- */
#scrollableModal .modal-content {
  background-color: #ffffff;
  color: #000000;
}

/*
 * モーダルの背景（バックドロップ）のスタイルを上書きします。
 */

/* エラーモーダル用の背景: 暗い赤色、半透明 */
.modal-backdrop.backdrop-error {
  background-color: rgba(114, 28, 36, 0.7);
  /* Bootstrapの.bg-dangerに近い色 */
}

/* 画面選択モーダル用の背景: 少し暗いグレー */
.modal-backdrop.backdrop-select {
  background-color: rgba(50, 50, 50, 0.75);
}

/* ▼▼▼ 追加: エラーモーダルのメッセージがはみ出るのを防ぐ ▼▼▼ */
#errorModal .modal-body {
  /* 長い文字列を強制的に改行させる */
  overflow-wrap: break-word;
  word-wrap: break-word;
  /* 旧ブラウザ互換用 */
}

#scrollableModal .modal-header {
  border: none;
  /* ヘッダーの境界線の色を調整 */
}

#scrollableModal .modal-footer {
  border-top-color: #495057;
  /* フッターの境界線の色を調整 */
}

/* モーダル内のリストアイテムのスタイル調整 */
#scrollableModal .list-group-item-action {
  background-color: #ffffff;
  color: #000000;
}

/* モーダルの閉じるボタンを白くする */
#scrollableModal .btn-close {
  filter: invert(1) grayscale(100%) brightness(200%);
}

/* (...前略...) */

/* スマホ表示 (md未満) のスタイルを定義 */
@media (max-width: 767.98px) {
  body {
    /* ヘッダーが下に来るので、paddingを下に変更 */
    padding-top: 0;
    padding-bottom: var(--header-height);
  }

  .header {
    /* ヘッダーを画面下部に固定 */
    top: auto;
    bottom: 0;
    /* ▼▼▼ 修正: ヘッダー上線に変更 ▼▼▼ */
    border-bottom: none;
    border-top: 1px solid #dee2e6;
  }

  .offcanvas.offcanvas-start {
    height: calc(var(--app-height) - var(--header-height));
    border: 0;
  }

  .offcanvas-body {
    /* サイドバー内のコンテンツを下に配置 */
    display: flex;
    flex-direction: column;
  }

  .offcanvas-body .nav {
    /* メニュー(ul)をコンテナの下端に押しやる */
    margin-top: auto;
  }

  /* ▼▼▼ 追加: スマホ表示でのモーダルサイズ調整 ▼▼▼ */
  #scrollableModal .modal-dialog {
    max-width: 80%;
    /* 横幅を画面の95%に制限 */
    margin: 1.75rem auto;
    /* 上下のマージンを確保し、左右中央揃え */
  }

  /* ▼▼▼ 追加: スマホ表示でのモーダルサイズ調整 ▼▼▼ */
  #scrollableModal .modal-dialog {
    max-width: 80%;
    /* 横幅を画面の80%に制限 */
    margin: 1.75rem auto;
    /* 上下のマージンを確保し、左右中央揃え */
  }

  /* ▼▼▼ 追加: スマホ表示でモーダルがフッターに被らないように調整 ▼▼▼ */
  #scrollableModal.modal {
    /* モーダル全体の高さを、フッターの高さを引いた分に制限する */
    height: calc(var(--app-height) - var(--header-height));
  }

}

/* (...後略...) */

/* PC表示 (md以上) のスタイルを再定義 */
@media (min-width: 768px) {
  .offcanvas-md.offcanvas-start {
    /* PCではヘッダーの下に配置 */
    top: var(--header-height);
    height: calc(var(--app-height) - var(--header-height));
    transform: none;
    visibility: visible !important;
    border-right: 1px solid #dee2e6;
    width: var(--sidebar-width-expanded);
    transition: width 0.3s ease;
  }

  .main-content {
    margin-left: var(--sidebar-width-expanded);
    transition: margin-left 0.3s ease;
  }

  /* --- is-collapsedクラスが付与された時のスタイル --- */
  .offcanvas-md.is-collapsed {
    width: var(--sidebar-width-collapsed);
  }

  .main-content.is-collapsed {
    margin-left: var(--sidebar-width-collapsed);
  }

  /* 畳んだ状態のレイアウトを「アイコン＋名称」の縦並びに変更 */
  .offcanvas-md.is-collapsed .nav-link {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
  }

  .offcanvas-md.is-collapsed .nav-link .bi {
    margin-right: 0;
    margin-bottom: 0.25rem;
    /* アイコンと名称の間に余白を追加 */
  }
}

/* スマホ横画面のスタイル (判定を画面の高さ基準に変更) */
/* PC表示 (md以上) および スマホ横画面 のスタイルを定義 */
@media (min-width: 768px),
(max-height: 500px) and (orientation: landscape) {

  /* --- 共通レイアウト調整 --- */
  body {
    padding-top: var(--header-height);
    padding-bottom: 0;
  }

  .header {
    top: 0;
    bottom: auto;
    border-bottom: 1px solid #dee2e6;
    border-top: none;
  }

  /* --- サイドバー & メインコンテンツ (PC/スマホ横画面 共通) --- */
  .offcanvas-md.offcanvas-start {
    top: var(--header-height);
    height: calc(var(--app-height) - var(--header-height));
    transform: none !important;
    visibility: visible !important;
    border-right: 1px solid #dee2e6;
    width: var(--sidebar-width-expanded);
    transition: width 0.3s ease;
  }

  .main-content {
    margin-left: var(--sidebar-width-expanded);
    transition: margin-left 0.3s ease;
  }

  /* --- is-collapsedクラスが付与された時のスタイル --- */
  .offcanvas-md.is-collapsed {
    width: var(--sidebar-width-collapsed);
  }

  .main-content.is-collapsed {
    margin-left: var(--sidebar-width-collapsed);
  }

  /* 畳んだ状態のレイアウトを「アイコン＋名称」の縦並びに変更 */
  .offcanvas-md.is-collapsed .nav-link {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
  }

  .offcanvas-md.is-collapsed .nav-link .bi {
    margin-right: 0;
    margin-bottom: 0.25rem;
    /* アイコンと名称の間に余白を追加 */
  }

  /* --- UI要素の調整 --- */
  /* 縦画面で下寄せにしていたメニューを通常の上寄せに戻す */
  .offcanvas-body {
    display: block;
  }

  .offcanvas-body .nav {
    margin-top: 0;
  }
}
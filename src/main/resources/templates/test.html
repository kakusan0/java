<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta charset="UTF-8" />
  <link
    href="/webjars/bootstrap/5.3.0/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <script src="/webjars/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <title th:text="#{register.page.title}"></title>
  <style>
    /* 改善点1: CSS変数を定義し、メンテナンス性を向上 */
    :root {
      --header-height: 60px;
      --sidebar-width-pc: 100px;
      --sidebar-width-pc-open: 200px;
      --sidebar-width-mobile: 250px;
      --transition-speed: 0.3s;
    }

    body {
      /* ヘッダーがコンテンツに重ならないように、bodyにpadding-topを設定 */
      padding-top: var(--header-height);
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: var(--header-height);
      background-color: #f8f9fa; /* Bootstrapの背景色に合わせて調整 */
      border-bottom: 1px solid #dee2e6;
      z-index: 1060; /* サイドバーやオーバーレイより上 */
    }

    .sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width-pc);
      height: calc(100vh - var(--header-height));
      background-color: #ffffff;
      border-right: 1px solid #dee2e6;
      overflow-x: hidden;
      z-index: 1050;
      /* 改善点2: スムーズなアニメーションを有効化 */
      /*transition: width var(--transition-speed) ease, left var(--transition-speed) ease;*/
    }
    .sidebar.open {
      width: var(--sidebar-width-pc-open);
    }

    .content {
      margin-left: var(--sidebar-width-pc);
      /*transition: margin-left var(--transition-speed) ease;*/
    }
    .content.open {
      margin-left: var(--sidebar-width-pc-open);
    }

    /* 改善点3: オーバーレイを追加し、スマホでの操作性を向上 */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1040; /* サイドバーより下 */
    }

    /* --- サイドバー内のスタイル --- */
    .sidebar .nav-link {
      padding: 15px;
      color: #343a40;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px; /* アイコンとテキストの間隔 */
      transition: background-color 0.2s ease;
    }
    .sidebar .nav-link:hover {
      background-color: #e9ecef;
    }
    .sidebar.open .nav-link {
      flex-direction: row;
      justify-content: flex-start;
      gap: 15px;
    }
    .px-custom {
      padding-left: 32px !important;
    }

    /* ▼▼▼ Bootstrapのブレークポイント(md)に合わせてレスポンシブ対応 ▼▼▼ */
    @media (max-width: 767.98px) {
      .sidebar {
        width: var(--sidebar-width-mobile);
        left: calc(-1 * var(--sidebar-width-mobile)); /* 初期状態で画面の外に隠す */
      }
      .sidebar.open {
        left: 0;
        width: var(--sidebar-width-mobile);
      }
      .content {
        margin-left: 0;
      }
      .content.open {
        margin-left: 0;
      }
      /* スマホでは常に「アイコン＋テキスト」のレイアウトにする */
      .sidebar .nav-link {
        flex-direction: row;
        justify-content: flex-start;
        gap: 15px;
      }
      /* スマホでメニューが開いた時だけオーバーレイを表示 */
      .sidebar.open ~ .overlay {
        display: block;
      }
    }
  </style>
</head>
<body>
<div class="header">
  <div class="d-flex align-items-center h-100 px-custom">
    <button class="btn btn-primary" type="button" id="menuButton">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</div>

<div class="sidebar">
  <ul class="nav flex-column">
    <li class="nav-item">
      <a class="nav-link" href="#">
        <i class="fas fa-home fa-fw"></i>
        <span>Home</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">
        <i class="fas fa-tachometer-alt fa-fw"></i>
        <span>Dashboard</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">
        <i class="fas fa-cog fa-fw"></i>
        <span>Settings</span>
      </a>
    </li>
  </ul>
</div>

<!-- 改善点3: オーバーレイ用のHTMLを追加 -->
<div class="overlay"></div>

<main class="content p-4">
  <div class="container-fluid">
    <table class="table">
      <tr th:each="row : ${#numbers.sequence(1, 100)}">
        <td th:each="col : ${#numbers.sequence(1, 10)}">
          コンテンツ <span th:text="${row * col}"></span>
        </td>
      </tr>
    </table>
  </div>
</main>

<!-- 改善点4: JavaScriptを改善 -->
<script>
  // DOMが完全に読み込まれてからスクリプトを実行する
  document.addEventListener('DOMContentLoaded', function() {
    const menuButton = document.getElementById('menuButton');
    const sidebar = document.querySelector('.sidebar');
    const content = document.querySelector('.content');
    const overlay = document.querySelector('.overlay');

    // メニューの開閉を行う共通関数
    function toggleMenu() {
      sidebar.classList.toggle('open');
      content.classList.toggle('open');
    }

    // ハンバーガーボタンとオーバーレイにクリックイベントを設定
    menuButton.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', toggleMenu);
  });
</script>
</body>
</html>

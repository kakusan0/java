<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta charset="UTF-8"/>
  <link href="/webjars/bootstrap/5.3.7/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="/webjars/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
  <link href="/css/style.css" rel="stylesheet"/>
  <title th:text="#{register.page.title}"></title>
</head>

<body>

<!-- ヘッダー (変更なし) -->
<header class="header">
  <div class="d-flex align-items-center h-100 px-3 px-md-5 position-relative">
    <div>
      <button aria-controls="sidebarMenu" class="btn btn-primary d-md-none border-0" data-bs-target="#sidebarMenu"
              data-bs-toggle="offcanvas" type="button">
        <i class="bi bi-list"></i>
      </button>
      <button class="btn btn-primary d-none d-md-block border-0" id="pcSidebarToggle" type="button">
        <i class="bi bi-list"></i>
      </button>
    </div>
    <div class="position-absolute top-50 start-50 translate-middle">
      <button class="btn btn-secondary" data-bs-target="#scrollableModal" data-bs-toggle="modal" id="itemSelectButton"
              type="button">
        <!-- ▼ 修正: コントローラーから渡された値でボタンのテキストを表示 ▼ -->
        <span id="selectedItemName" th:text="${selectedScreenName}">画面を選択</span>
      </button>
    </div>
  </div>
</header>

<!-- サイドバー (変更なし) -->
<div aria-labelledby="sidebarMenuLabel" class="offcanvas offcanvas-start offcanvas-md is-collapsed" id="sidebarMenu"
     tabindex="-1">
  <div class="offcanvas-body p-0">
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link text-dark" href="#">
          <i class="bi bi-house-door-fill"></i>
          <span>Home</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" href="#">
          <i class="bi bi-speedometer2"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" href="#">
          <i class="bi bi-gear-fill"></i>
          <span>Settings</span>
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- メインコンテンツ -->
<main class="main-content p-4 is-collapsed">
  <div class="container-fluid">

    <!-- ▼▼▼ 修正: th:switchブロックのみを残し、後の重複コンテンツを削除 ▼▼▼ -->
    <div th:switch="${currentScreen}">
      <div th:case="'ホーム'" th:replace="~{fragments/home :: content}"></div>
      <div th:case="'ダッシュボード'" th:replace="~{fragments/dashboard :: content}"></div>
      <div th:case="'設定'" th:replace="~{fragments/settings :: content}"></div>
      <div th:case="*">
        <p>上のボタンから表示する画面を選択してください。</p>
      </div>
    </div>

  </div>
  <!-- ▲▲▲ ここにあった重複した container-fluid と table を削除 ▲▲▲ -->
</main>

<!-- モーダル -->
<div aria-hidden="true" aria-labelledby="scrollableModalLabel" class="modal fade" id="scrollableModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title" id="scrollableModalLabel">画面を選択してください</h5>
        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
      </div>
      <div class="modal-body">
        <div class="list-group">
          <!-- ▼ 修正: th:hrefで正しいURLを生成し、不要なdata属性を削除 ▼ -->
          <form class="d-grid" method="get" th:action="@{/}" th:each="screen : ${screens}">
            <!-- screenNameをリクエストパラメータとして送信するための隠しフィールド -->
            <input name="screenName" th:value="${screen}" type="hidden"/>
            <!-- フォームを送信するサブミットボタン -->
            <button class="list-group-item list-group-item-action text-start" th:text="${screen}"
                    type="submit"></button>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">キャンセル</button>
      </div>
    </div>
  </div>
</div>

<script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
<script src="/webjars/bootstrap/5.3.7/js/bootstrap.bundle.min.js"></script>
<script src="/js/main.js"></script>

</body>

</html>
